<?php
/**
 * @file
 *  Test cases for theme functions for Drupal 7 upgrade.
 *
 *  theme_xero_addresses
 *  theme_xero_lineitems
 *  template_preprocess_xero_contact
 *  template_preprocess_xero_invoice
 *  template_preprocess_xero_creditnote
 */

/**
 * @class XeroThemeTestCase
 *   The basic unit test class to load up required files so we can
 *   perform quick tests on function output.
 */
class XeroThemeTestCase extends DrupalUnitTestCase {

  function setUp() {
    parent::setUp();

    module_load_include('inc', 'xero', 'tests/xero.theme');
  }
}

/**
 * @class XeroThemeAddressesTestCase
 */
class XeroThemeAddressesTestCase extends XeroThemeTestCase {

  public static function getInfo() {
    return array(
      'name' => t('Theme Addresses'),
      'description' => t('Test theme function output.'),
      'group' => t('Xero'),
    );
  }

  function setUp() {
    parent::setUp();

    $this->addresses = xero_make('address');
    $this->addresses['Address']['AddressType'] = 'STREET';
    $this->addresses['Address']['AddressLine1'] = $this->randomString(15);
    $this->addresses['Address']['City'] = $this->randomName(5);
    $this->addresses['Address']['Region'] = $this->randomName(10);
    $this->addresses['Address']['CountryCode'] = $this->randomName(2);
    $this->addresses['Address']['PostalCode'] = $this->randomName(3);
  }

  function testThemeAddress() {
    $output = theme_xero_addresses(array('addresses' => $this->addresses));

    $address_line = '<div class="xero-address-line">' . check_plain($this->addresses['Address']['AddressLine1']) . '</div>';
    $city_line = '<div class="xero-address-line">' . check_plain($this->addresses['Address']['City']) . ', ';
    $city_line .= check_plain($this->addresses['Address']['Region']) . ' ' . check_plain($this->addresses['Address']['PostalCode']);
    $city_line .=  ' ' . check_plain($this->addresses['CountryCode']) . '</div>';

    $this->assertTrue(preg_match('/' . preg_quote($address_line) . '/'), t('Found street address line: %line.', array('%line' => $address_line)));
    $this->assertTrue(preg_match('/' . preg_quote($city_line) . '/'), t('Found city, region, etc... line: %line.', array('%line' => $city_line)));
  }

}

